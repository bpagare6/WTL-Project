let models,bcrypt,config;_e4b‍.x([["default",()=>_e4b‍.o]]);_e4b‍.w("../models/index",[["default",["models"],function(v){models=v}]]);_e4b‍.w("bcrypt",[["default",["bcrypt"],function(v){bcrypt=v}]]);_e4b‍.w("../config",[["default",["config"],function(v){config=v}]]);/* File to handle User Activities */




// Authentication Function
async function authenticate_user(user) {
  var valid_user, authenticated_user;

  const valid_username =
    typeof user.username == "string" && user.username.trim() != "";
  const valid_password =
    typeof user.password == "string" &&
    user.password.trim() != "" &&
    user.password.trim().length >= 6;

  valid_user = valid_username && valid_password;

  if (user.isteacher) {
    models.teachers
      .findOne({
        where: {
          username: user.username
        }
      })
      .then(user => {
        if (!user) {
          // No User found
          authenticated_user = false;
        } else {
          var password = user["dataValues"]["password"];
          var hashed_password;
          bcrypt.hash("password", config.bcrypt_salt_rounds).then(hash => {
            hashed_password = hash;
          });
          if (hashed_password === password) {
            authenticated_user = true;
          } else {
            authenticated_user = false;
          }
        }
      });
  } else {
    models.students
      .findOne({
        where: {
          username: user.username
        }
      })
      .then(user => {
        if (!user) {
          // No User found
          authenticated_user = false;
        } else {
          var password = user["dataValues"]["password"];
          var hashed_password;
          bcrypt.hash("password", config.bcrypt_salt_rounds).then(hash => {
            hashed_password = hash;
          });
          if (hashed_password === password) {
            authenticated_user = true;
          } else {
            authenticated_user = false;
          }
        }
      });
  }

  return valid_user && authenticated_user;
}

_e4b‍.d({
  authenticate_user
});
